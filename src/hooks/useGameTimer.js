import { useState, useEffect, useCallback } from 'react';

/**
 * useGameTimer
 * -----------------------------------------------------------------------------
 * –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –í–ò–ö–õ–Æ–ß–ù–û –∑–∞ —Ç–∞–π–º–µ—Ä –≥—Ä–∏.
 *
 * üîπ –ù–µ –∑–Ω–∞—î –Ω—ñ—á–æ–≥–æ –ø—Ä–æ:
 *    - —Å—Ç–∞—Ç—É—Å –≥—Ä–∏ (victory / defeat)
 *    - –ª–æ–≥—ñ–∫—É –∫–ª—ñ—Ç–∏–Ω–æ–∫
 *    - –º—ñ–Ω—É–≤–∞–Ω–Ω—è
 *
 * üîπ –ô–æ–≥–æ –∑–∞–¥–∞—á–∞:
 *    - —Ä–∞—Ö—É–≤–∞—Ç–∏ —Å–µ–∫—É–Ω–¥–∏
 *    - —Å—Ç–∞—Ä—Ç—É–≤–∞—Ç–∏ / –∑—É–ø–∏–Ω—è—Ç–∏ —ñ–Ω—Ç–µ—Ä–≤–∞–ª
 *    - —Å–∫–∏–¥–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è
 *
 * –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ —Ä–æ–ª—å:
 * –¶–µ —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π state-–º–µ–Ω–µ–¥–∂–µ—Ä —á–∞—Å—É.
 * –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—é (–∫–æ–ª–∏ —Å—Ç–∞—Ä—Ç—É–≤–∞—Ç–∏/–∑—É–ø–∏–Ω—è—Ç–∏) —Ä–æ–±–∏—Ç—å useMinesweeper.
 */
export function useGameTimer() {
  /**
   * –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–µ–∫—É–Ω–¥ –∑ –º–æ–º–µ–Ω—Ç—É —Å—Ç–∞—Ä—Ç—É –≥—Ä–∏.
   */
  const [seconds, setSeconds] = useState(0);

  /**
   * –ü—Ä–∞–ø–æ—Ä–µ—Ü—å ‚Äî —á–∏ –∑–∞—Ä–∞–∑ —Ç–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–Ω–∏–π.
   * –°–∞–º–µ –≤—ñ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—é—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è / –æ—á–∏—â–µ–Ω–Ω—è setInterval.
   */
  const [isRunning, setIsRunning] = useState(false);

  /**
   * –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞.
   * –ù–µ —Å—Ç–≤–æ—Ä—é—î —ñ–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞–ø—Ä—è–º—É ‚Äî –ª–∏—à–µ –∑–º—ñ–Ω—é—î —Å—Ç–∞–Ω.
   * –°–∞–º —ñ–Ω—Ç–µ—Ä–≤–∞–ª —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ useEffect.
   */
  const start = useCallback(() => {
    setIsRunning(true);
  }, []);

  /**
   * –ó—É–ø–∏–Ω–∫–∞ —Ç–∞–π–º–µ—Ä–∞.
   * –ü—Ä–∏ –∑–º—ñ–Ω—ñ isRunning ‚Üí useEffect –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å —ñ–Ω—Ç–µ—Ä–≤–∞–ª.
   */
  const stop = useCallback(() => {
    setIsRunning(false);
  }, []);

  /**
   * –ü–æ–≤–Ω–∏–π —Ä–µ—Å–µ—Ç —Ç–∞–π–º–µ—Ä–∞:
   * - —Å–µ–∫—É–Ω–¥–∏ ‚Üí 0
   * - –∑—É–ø–∏–Ω–∫–∞ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É
   *
   * –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç—ñ –≥—Ä–∏.
   */
  const reset = useCallback(() => {
    setSeconds(0);
    setIsRunning(false);
  }, []);

  /**
   * –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ —Ç–∞–π–º–µ—Ä–∞.
   *
   * –ö–æ–ª–∏ isRunning === true:
   *   - —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è setInterval
   *   - –∫–æ–∂–Ω—É —Å–µ–∫—É–Ω–¥—É –∑–±—ñ–ª—å—à—É—î seconds
   *
   * –ö–æ–ª–∏ isRunning === false:
   *   - —ñ–Ω—Ç–µ—Ä–≤–∞–ª –Ω–µ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è
   *
   * Cleanup:
   *   - –ø—Ä–∏ –∑–º—ñ–Ω—ñ isRunning
   *   - –ø—Ä–∏ unmount
   *
   * –í–∞–∂–ª–∏–≤–æ:
   * –ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π setState (s => s + 1),
   * —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø—Ä–æ–±–ª–µ–º –∑—ñ stale state.
   */
  useEffect(() => {
    if (!isRunning) return;

    const id = setInterval(() => {
      setSeconds((s) => s + 1);
    }, 1000);

    return () => clearInterval(id);
  }, [isRunning]);

  /**
   * –ü—É–±–ª—ñ—á–Ω–∏–π API —Ö—É–∫–∞.
   * UI –∞–±–æ useMinesweeper –ø—Ä–∞—Ü—é—é—Ç—å —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ —Ü–µ–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
   */
  return {
    seconds,
    isRunning,
    start,
    stop,
    reset,
  };
}